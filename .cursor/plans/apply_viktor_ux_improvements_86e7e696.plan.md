---
name: Apply Viktor UX Improvements
overview: Implement Viktor's UX audit recommendations by applying the provided patches to improve Lucy's personality, progress updates, error handling, and formatting.
todos:
  - id: apply-pr1
    content: Apply 0001-ux-disable-deai-llm-rewrite.patch
    status: pending
  - id: apply-pr3
    content: Apply pr3-progress-messages-overhaul.patch
    status: pending
  - id: apply-pr4
    content: Apply pr4-context-aware-errors.patch
    status: pending
  - id: apply-pr5
    content: Apply 0001-ux-improve-humanize-module-prompts-and-fallback-vari.patch
    status: pending
  - id: apply-pr7
    content: Apply 0007-ux-cron-output-formatting.patch
    status: pending
  - id: replace-soul-md
    content: Replace assets/SOUL.md with downloaded version
    status: pending
isProject: false
---

# Apply Viktor UX Improvements

Based on the deep UX audit and the provided patches, here is the plan to adapt Viktor's philosophy to Lucy's architecture.

## Analysis of Viktor's Feedback

**What we're doing wrong:**

- **Personality Erasure:** The Tier 2 LLM rewrite in the De-AI pipeline uses a generic prompt and cheap model, which flattens the personality generated by the main LLM.
- **Invisible Progress:** Updating a single progress message hides the journey and feels like a loading spinner.
- **Generic Errors:** Error messages lack context, leaving users confused about what failed.
- **Negative Constraints:** `SOUL.md` is heavily focused on anti-patterns (what *not* to do), which paralyzes the model into producing bland output.
- **Repetitive Warmth:** The `humanize` module generates messages with identical structures (Emoji + short clause).
- **Inconsistent Formatting:** Cron job outputs bypass the Block Kit formatting pipeline.

**What we're doing right:**

- The Tier 1 regex-based De-AI layer effectively catches specific tells without destroying structure.
- The underlying architecture (sub-agents, tools, cron system) is solid.
- We already have the infrastructure for Block Kit formatting and Human-in-the-loop (HITL); they just need to be wired up better.

**What we can adapt (The Fixes):**
The provided patches perfectly encapsulate the necessary changes. They are targeted, safe, and respect Lucy's existing architecture.

## Implementation Steps

1. **Disable De-AI LLM Rewrite (PR 1)**
  - Apply `0001-ux-disable-deai-llm-rewrite.patch` to `src/lucy/core/output.py`.
  - This changes `_LLM_REWRITE_THRESHOLD` to 999, effectively disabling the destructive LLM rewrite while preserving the effective regex safety net.
2. **Overhaul Progress Messages (PR 3)**
  - Apply `pr3-progress-messages-overhaul.patch` to `src/lucy/core/agent.py`.
  - This changes progress updates to post new messages instead of editing in-place, and weaves `task_hint` into the status lines for context-aware updates.
3. **Implement Context-Aware Errors (PR 4)**
  - Apply `pr4-context-aware-errors.patch` to `src/lucy/core/agent.py` and `src/lucy/slack/handlers.py`.
  - This maps internal tool names to human-readable descriptions and classifies error types, providing specific and actionable error messages.
4. **Improve Humanize Prompts & Variety (PR 5)**
  - Apply `0001-ux-improve-humanize-module-prompts-and-fallback-vari.patch` to `src/lucy/core/humanize.py`.
  - This updates the prompts to enforce structural variety and expands the fallback messages with more natural phrasing.
5. **Format Cron Output (PR 7)**
  - Apply `0007-ux-cron-output-formatting.patch` to `src/lucy/crons/scheduler.py`.
  - This routes plain-text cron output through `text_to_blocks()` and `enhance_blocks()` for rich Block Kit formatting.
6. **Rewrite SOUL.md**
  - Replace `assets/SOUL.md` with the contents of `/Users/ojashyadav/Downloads/SOUL.md`.
  - This shifts the personality guide from negative constraints to positive voice direction with concrete examples.

